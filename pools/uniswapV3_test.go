package pools

import (
	"context"
	"encoding/hex"
	"encoding/json"
	"fmt"
	"math/big"
	"reflect"
	"testing"

	"github.com/FastLane-Labs/fastlane-online-solver/log"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/ethclient"
)

type serializedUniswapV3Pool struct {
	Address         common.Address    `json:"address"`
	TokenA          common.Address    `json:"token_a"`
	TokenB          common.Address    `json:"token_b"`
	TickSpacing     int64             `json:"tick_spacing"`
	Fee             int64             `json:"fee"`
	Tick            int64             `json:"tick"`
	Liquidity       string            `json:"liquidity"`
	SqrtPrice96     string            `json:"sqrt_price_96"`
	LiquidityDeltas map[string]string `json:"liquidity_deltas"`
}

func (p *UniswapV3Pool) toTestSerialized() *serializedUniswapV3Pool {
	sp := serializedUniswapV3Pool{
		Address:         p.address,
		TokenA:          p.tokenA,
		TokenB:          p.tokenB,
		TickSpacing:     p.tickSpacing,
		Fee:             p.fee,
		Tick:            p.tick,
		Liquidity:       p.liquidity.String(),
		SqrtPrice96:     p.sqrtPrice96.String(),
		LiquidityDeltas: make(map[string]string),
	}

	for k, v := range p.liquidityDeltas {
		sp.LiquidityDeltas[fmt.Sprintf("%d", k)] = v.String()
	}

	return &sp
}

func (p *UniswapV3Pool) testSerializeFull() ([]byte, error) {
	return json.Marshal(p.toTestSerialized())
}

func (p *UniswapV3Pool) testDeserializeFull(data []byte) error {
	var sp serializedUniswapV3Pool
	err := json.Unmarshal(data, &sp)
	if err != nil {
		return fmt.Errorf("failed to deserialize pool: %v", err)
	}

	p.address = sp.Address
	p.tokenA = sp.TokenA
	p.tokenB = sp.TokenB
	p.tickSpacing = sp.TickSpacing
	p.fee = sp.Fee
	p.tick = sp.Tick

	p.liquidity = new(big.Int)
	p.liquidity.SetString(sp.Liquidity, 10)

	p.sqrtPrice96 = new(big.Int)
	p.sqrtPrice96.SetString(sp.SqrtPrice96, 10)

	p.liquidityDeltas = make(map[int64]*big.Int)
	for k, v := range sp.LiquidityDeltas {
		key := int64(0)
		fmt.Sscanf(k, "%d", &key)
		value := new(big.Int)
		value.SetString(v, 10)
		p.liquidityDeltas[key] = value
	}

	return nil
}

func TestSerialization(t *testing.T) {
	// Initialize a pool with some test data
	originalPool := &UniswapV3Pool{
		address:     common.HexToAddress("0x123"),
		tokenA:      common.HexToAddress("0xabc"),
		tokenB:      common.HexToAddress("0xdef"),
		tickSpacing: 60,
		fee:         3000,
		tick:        12345,
		liquidity:   big.NewInt(1000),
		sqrtPrice96: big.NewInt(2000),
		liquidityDeltas: map[int64]*big.Int{
			-75420: big.NewInt(100),
			-75780: big.NewInt(-50),
		},
	}

	// Serialize the pool
	serializedData, err := originalPool.testSerializeFull()
	if err != nil {
		t.Fatalf("Serialization failed: %v", err)
	}

	// Deserialize the pool
	deserializedPool := &UniswapV3Pool{}
	err = deserializedPool.testDeserializeFull(serializedData)
	if err != nil {
		t.Fatalf("Deserialization failed: %v", err)
	}

	// Compare the original and deserialized pool
	if !reflect.DeepEqual(originalPool, deserializedPool) {
		t.Fatalf("Deserialized pool does not match original. Expected %v, got %v", originalPool, deserializedPool)
	}
}

func (p *UniswapV3Pool) loadFullData(client *ethclient.Client) error {
	if p.address == (common.Address{}) {
		return fmt.Errorf("address is empty")
	}
	fillUniswapV3StaticData(client, []*UniswapV3Pool{p}, 2)
	GeneratePoolsDynamicData_UniswapV3(client, []*UniswapV3Pool{p}, 2)

	return nil
}

// To replicate test `test_execute_v3_v3` in sol/test/FastlaneOnlineSolver.t.sol
// Start anvil fork with anvil --fork-url <RPC URL> --fork-block-number 60144000 --port 8546
// Remove prefix `dont` from test name to run
func DontTestUniswapV3SwapOutput(t *testing.T) {
	log.InitLogger("debug")

	btc := common.HexToAddress("0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6")
	weth := common.HexToAddress("0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619")
	link := common.HexToAddress("0x53E0bca35eC356BD5ddDFebbD1Fc0fD03FaBad39")

	p1 := NewUniswapV3Pool(common.HexToAddress("0x3e31AB7f37c048FC6574189135D108df80F0ea26"))
	p2 := NewUniswapV3Pool(common.HexToAddress("0x50eaEDB835021E4A108B7290636d62E9765cc6d7"))

	client, err := ethclient.Dial("http://localhost:8546")
	if err != nil {
		t.Fatal("Failed to connect to the Ethereum client:", err)
	}

	blockNumber, err := client.BlockNumber(context.Background())
	if err != nil {
		t.Fatal("Failed to get block number:", err)
	}
	fmt.Println("Block number:", blockNumber)
	if err != nil {
		t.Fatal("Failed to connect to the Ethereum client:", err)
	}
	if err := p1.loadFullData(client); err != nil {
		t.Fatal("Failed to load full data for pool 1:", err)
	}
	if err := p2.loadFullData(client); err != nil {
		t.Fatal("Failed to load full data for pool 2:", err)
	}
	amountIn := big.NewInt(0).Mul(big.NewInt(1e18), big.NewInt(1e4))
	p1Output, err := p1.Output(link, weth, amountIn)
	if err != nil {
		t.Fatal("Failed to get output for pool 1:", err)
	}
	p1ExpectedOutput, ok := big.NewInt(0).SetString("39844856842815895321", 10)
	if !ok {
		t.Fatal("Failed to parse expected output")
	}
	if p1Output.Cmp(p1ExpectedOutput) != 0 {
		t.Fatalf("Expected output %v, got %v", p1ExpectedOutput, p1Output)
	}
	p2Output, err := p2.Output(weth, btc, p1Output)
	if err != nil {
		t.Fatal("Failed to get output for pool 2:", err)
	}
	expectedOutput, ok := big.NewInt(0).SetString("192370597", 10)
	if !ok {
		t.Fatal("Failed to parse expected output")
	}
	if p2Output.Cmp(expectedOutput) != 0 {
		t.Fatalf("Expected output %v, got %v", expectedOutput, p2Output)
	}
}

// func buildUniswapV3Pool(client *ethclient.Client, multicallAddr common.Address, poolAddr common.Address) (*UniswapV3Pool, error){
// 	poolsArr := []*UniswapV3Pool{NewUniswapV3Pool(poolAddr)}
// 	err := fillUniswapV3StaticData(poolsArr, client, multicallAddr)
// 	if err != nil {
// 		return nil, fmt.Errorf("failed to fill uniswap v3 static data: %v", err)
// 	}
// 	err = GeneratePoolsDynamicData_UniswapV3(client, poolsArr, multicallAddr)
// 	if err != nil {
// 		return nil, fmt.Errorf("failed to generate uniswap v3 dynamic data: %v", err)
// 	}
// 	return poolsArr[0], nil
// }

// func TestGenerateUniswapV3Pool(t *testing.T) {
// 	poolAddr := common.HexToAddress("0xA374094527e1673A86dE625aa59517c5dE346d32")
// 	rpc_url := "<RPC_URL>"
// 	client, err := ethclient.Dial(rpc_url)
// 	if err != nil {
// 		t.Fatalf("Failed to connect to the Ethereum client: %v", err)
// 	}
// 	pool, err := buildUniswapV3Pool(client, common.HexToAddress("0xcA11bde05977b3631167028862bE2a173976CA11"), poolAddr)
// 	if err != nil {
// 		t.Fatalf("Failed to build Unisswap V3 pool: %v", err)
// 	}

// 	serializedData, err := pool.testSerializeFull()
// 	if err != nil {
// 		t.Fatalf("Serialization failed: %v", err)
// 	}

// 	fmt.Println("Serialized pool-", hex.EncodeToString(serializedData))
// }

func TestUniswapV3Pool(t *testing.T) {
	serializedPoolStr := "7b2261646472657373223a22307861333734303934353237653136373361383664653632356161353935313763356465333436643332222c22746f6b656e5f61223a22307830643530306231643865386566333165323163393964316462396136343434643361646631323730222c22746f6b656e5f62223a22307832373931626361316632646534363631656438386133306339396137613934343961613834313734222c227469636b5f73706163696e67223a31302c22666565223a3530302c227469636b223a2d3238323836302c226c6971756964697479223a2238343038383738363030363538333134313739222c22737172745f70726963655f3936223a223537313437393736373636323230303632393439333736222c226c69717569646974795f64656c746173223a7b222d323737383630223a223238313734323033373737323739393630222c222d323737383730223a223530353739323739333137343537313036222c222d323737383830223a223233373530333437373337343137333733222c222d323737383930223a223535333338363137313233313035353239222c222d323737393030223a223136373131353237313631343231323632222c222d323737393130223a223231303233383835383438353232313732222c222d323737393230223a223237333031373030303730303935353236222c222d323737393330223a223432343033343531353134303035373630222c222d323737393430223a223438313639343134333539363930363230222c222d323737393530223a22313436373331393835393138333136323730222c222d323737393630223a223237373534333238383238393031343836222c222d323737393730223a223232383232303531353432343235393235222c222d323737393830223a223230333939393034373538343331353730222c222d323737393930223a223138353735383232333032333731313337222c222d323738303030223a223330313232323434323333383730303535222c222d323738303130223a223230383735383030333532363637333037222c222d323738303230223a223133313139323531363732383735343932222c222d323738303330223a223139333938383637373234313337343439222c222d323738303430223a223139383231323836353037303339343839222c222d323738303530223a223131323039373031323838323636373638222c222d323738303630223a223337363834373439343636393036373835222c222d323738303730223a223431303038313035363637363435323938222c222d323738303830223a2239353437353732393731363430363630222c222d323738303930223a2234393936303437373635323331393434222c222d323738313030223a223230373531393535333430333737353630222c222d323738313130223a223130363734333935323431303238373138222c222d323738313230223a2234353434333933373837373339313630222c222d323738313330223a2237333236303635343631343736343033222c222d323738313430223a2238343536343130323136343937383239222c222d323738313530223a2238383636323335333135353333303833222c222d323738313630223a2238373239343738333732303635383535222c222d323738313730223a223130383234363638383334373635383138222c222d323738313830223a22323230373139373934343831313332303339222c222d323738313930223a22313337393537353730393635393734303230222c222d323738323030223a2238393139353332313339363835333038222c222d323738323130223a223132343238313233393932353230323537222c222d323738323230223a223131313333333231303831313837313332222c222d323738323330223a223131313531333431343034303330313433222c222d323738323430223a2234383230303833353434393635343335222c222d323738323530223a2234303031333834323332323531323932222c222d323738323630223a2237383534383637373833363535393830222c222d323738323730223a223335363435313631303637393739303836222c222d323738323830223a223333393431303234383630383439363032222c222d323738323930223a223139333635353734363438333233303737222c222d323738333030223a22313135393136333438373235393631323838222c222d323738333130223a223738313733373132333836373639313937222c222d323738333230223a223134323031393239363138353539343032222c222d323738333330223a223130343232323236363838333231343836222c222d323738333430223a2238393433343233333636313332333638222c222d323738333530223a223231313234353730333938393736353531222c222d323738333630223a223336343731303737343039303339373138222c222d323738333730223a223130383937353532303338333734303139222c222d323738333830223a223135303338383030353837343435303636222c222d323738333930223a223133393232333533323835383539393635222c222d323738343030223a223235303534323737383238313238383039222c222d323738343130223a2238333531373636393134313739363531222c222d323738343230223a223139373137383030353535303635303438222c222d323738343330223a223334383935343832333938333932333039222c222d323738343430223a2235303435363739373037353238333232222c222d323738343530223a2238343734383735383633373435323337222c222d323738343630223a2237393930323030373337353932373234222c222d323738343730223a2235333538393034383733363138323735222c222d323738343830223a22323839353637323430383930363332313235222c222d323738343930223a22313938303934333632353338343139343136222c222d323738353030223a223131313137373837343736323335343232222c222d323738353130223a223933333437353633303133393530303933222c222d323738353230223a2235363034383636343538333934383239222c222d323738353330223a223132323439353634363232323239333737222c222d323738353430223a223237363531393736373236373032373034222c222d323738353530223a22343730383434363630383935383438363730222c222d323738353630223a22313437363033303938303832353937393336222c222d323738353730223a223236383933373134353233313332383733222c222d323738353830223a2234393334373231383235393436333831222c222d323738353930223a2237393531373839343935333931303831222c222d323738363030223a2238393037303539313532323632343135222c222d323738363130223a22333033393938343235323332313239363833222c222d323738363230223a2239313337383632303535313735363437222c222d323738363330223a223135353932343732343735383132333232222c222d323738363430223a2237393638343832303732313636393832222c222d323738363530223a2237333238393535343238353534363035222c222d323738363630223a2236313838353533323437323033373539222c222d323738363730223a223937353537373130393334393433363131222c222d323738363830223a223232353634363330313331383236393234222c222d323738363930223a2235323330353631373037373231343133222c222d323738373030223a223236363830313234323536323536303635222c222d323738373130223a2233313137333334373632383030323630222c222d323738373230223a2231343532303830313135303732383037222c222d323738373330223a2231363535343830343237363831333139222c222d323738373430223a2236313532343934383237363233333230222c222d323738373530223a223230393433353133353232343830303330222c222d323738373630223a2238373132313735303831353237373339222c222d323738373730223a223135353437363634343136393730333531222c222d323738373830223a2234353532373135333132323030343532222c222d323738373930223a223238363531383233333832373933353331222c222d323738383030223a223131373639373531373538393735303238222c222d323738383130223a223737303830313130323030353834373839222c222d323738383230223a223131353831323937363332313234373933222c222d323738383330223a2235333833343733323236323930363837222c222d323738383430223a2232333233343333313038383237363134222c222d323738383530223a2237353339313730363239333037333839222c222d323738383630223a2236383533303631303336363638333739222c222d323738383730223a223133373134313738363935373331303036222c222d323738383830223a2237313033303031343430383831353239222c222d323738383930223a2233363433373733363534313839343935222c222d323738393030223a223237313637303833323635383333323536222c222d323738393130223a2231373638323937303133383736323432222c222d323738393230223a223235333036383236353235363737383738222c222d323738393330223a2231393135393936303235333932333434222c222d323738393430223a223232373432353139393539393930353239222c222d323738393530223a2234353035323934373139363037353436222c222d323738393630223a2232313235323232373439333933393637222c222d323738393730223a2234323331303631363235363630313831222c222d323738393830223a2236343631303434353835323232393232222c222d323738393930223a223132313632363232323738313836313932222c222d323739303030223a223331353839313630393732323435313938222c222d323739303130223a2237313930323737383238353833333932222c222d323739303230223a223130353831393532313734323035313734222c222d323739303330223a2232323139333335343933393638303536222c222d323739303430223a2234373233363433373439303934343232222c222d323739303530223a2232383630343739343930313035343136222c222d323739303630223a223132323239343632383630363236363135222c222d323739303730223a22333733353933323132383537363534353134222c222d323739303830223a223137343632313437373235313230393930222c222d323739303930223a223136323938373437393838313434363636222c222d323739313030223a2235313538303431363730393932323932222c222d323739313130223a223737373139363234373235373230333034222c222d323739313230223a223134343639303235373031343330333633222c222d323739313330223a2234343033363730363132393734383535222c222d323739313430223a2236393833393930343236303436383238222c222d323739313530223a22353932333133323434373631363638222c222d323739313630223a2233363132333533353232323438393630222c222d323739313730223a2231393732323933363337353238323230222c222d323739313830223a2233363730333939373530323436373036222c222d323739313930223a223133363339393538383637353831313134222c222d323739323030223a223736323039323236303332323931373035222c222d323739323130223a223131303630363338303938373832363633222c222d323739323230223a223138353933343738343931313033343333222c222d323739323330223a223530353631333839353432313236393332222c222d323739323430223a223331333233373839303639373533333833222c222d323739323530223a223531393231393531363634313835313130222c222d323739323630223a2233393131363036303533303533313833222c222d323739323730223a2232333031373334343137353836313037222c222d323739323830223a223334333332313136303132323636383338222c222d323739323930223a2231333533333038363436313935313537222c222d323739333030223a2238343735333033343339373130363234222c222d323739333130223a2232383730373731303835383633333435222c222d323739333230223a2231323133363434333832303536363734323730222c222d323739333330223a223330323839343937333531393238373030222c222d323739333430223a22343338383839323339363532333437363935222c222d323739333530223a2239313431383635333334303335363231222c222d323739333630223a2239343937313537343435393539343334222c222d323739333730223a223130383039323830323432393232383433222c222d323739333830223a2239353034383831323434323331363634222c222d323739333930223a2237343836363433383433353333373233222c222d323739343030223a22363839373331353436323732303737222c222d323739343130223a2236333133363334353532323131373136222c222d323739343230223a2234313133333135353935383034343638222c222d323739343330223a2233373239333337313630343833303637222c222d323739343430223a2231333839373434313434343432313137222c222d323739343530223a2233393031343732323230333431383339222c222d323739343630223a22383139393031323736313630393731222c222d323739343730223a223139393836383639313239363036313035222c222d323739343830223a2233363834393635343439393034393833222c222d323739343930223a2234313235313235333635373031343035222c222d323739353030223a2236303035373738373539343034313638222c222d323739353130223a2233303131323533393731363131393530222c222d323739353230223a2235353434313133343639333339383237222c222d323739353330223a2232313436313136313535393435323138222c222d323739353430223a223233333139353234393036373338373835222c222d323739353530223a2235373134303232363032303830323234222c222d323739353630223a223133363835383530383038363639333737222c222d323739353730223a2233393831383937373337313535343639222c222d323739353830223a2233333836363032353234303337323837222c222d323739353930223a2233323530323530333037373031393038222c222d323739363030223a223139363337393134383639373730393033222c222d323739363130223a22313332383430323034313239383931343232222c222d323739363230223a223338363630373133343438373131333235222c222d323739363330223a2233333732323736313431303031303635222c222d323739363430223a223131353434343038323832393436373834222c222d323739363530223a223232303636363337363736363236323637222c222d323739363630223a223232363632353536333939393731353031222c222d323739363730223a2232303437303330343036373536373334222c222d323739363830223a2239353932383039333631313833373633222c222d323739363930223a2236373135323639383438353436383534222c222d323739373030223a223130333138393639333735333638363234222c222d323739373130223a2236343737393837343139313931343333222c222d323739373230223a223239393333313230323434353533393932222c222d323739373330223a2238373535363739303539333634333931222c222d323739373430223a22313135343330333031323635323539383036222c222d323739373530223a223238383133383533313636323731383532222c222d323739373630223a22313034333338363134333337383339393531222c222d323739373730223a2234383338343739363836313938303239222c222d323739373830223a2234303038303835353339323939333932222c222d323739373930223a223231393838373433333939363839363436222c222d323739383030223a223331373231383239303435373136393230222c222d323739383130223a223836393835303530353039373633313233222c222d323739383230223a22313339323132373336313935303330393431222c222d323739383330223a2234333134303931393530303432353835222c222d323739383430223a2235353932333332383834373537353139222c222d323739383530223a2233383432373832303039323035333032222c222d323739383630223a223131333237373638353337333834333934222c222d323739383730223a223237303435373336323036383131333838222c222d323739383830223a223331303738393437323530373732353336222c222d323739383930223a22363332333934363833333331323433343438222c222d323739393030223a2239353137333536383635373436303632222c222d323739393130223a223130393333353739363230363935333234222c222d323739393230223a2232353436303838313336333634353136222c222d323739393330223a22313333333736383132383436353335383334222c222d323739393430223a2232303939353833323338333435373333222c222d323739393530223a22313237393530313033313239343236323636222c222d323739393630223a22383833383935393534313033363233222c222d323739393730223a2231333932333830373735393034343932222c222d323739393830223a2238393239363931343035333236303836222c222d323739393930223a2236313433313435353438303937373330222c222d323830303030223a223233303030333731353736383235393830222c222d323830303130223a223136343631383334393830303437363939222c222d323830303230223a223230343839333134313434393435333734222c222d323830303330223a223430343138313338383439363433333136222c222d323830303430223a223234313632373439373038363133353533222c222d323830303530223a223836313038313032313232363733373631222c222d323830303630223a22363039303838353636393531393939353834222c222d323830303730223a223234323433323637393631383330383835222c222d323830303830223a22323230363339373739313939373733323936222c222d323830303930223a223135363238373738343036303730303332222c222d323830313030223a22343037393031363137303137373339383536222c222d323830313130223a223234393336333138373038303831323438222c222d323830313230223a223233353333323730303337333035303335222c222d323830313330223a223136323334333737343837373031393830222c222d323830313430223a223830343336343131383336313831363039222c222d323830313530223a223237303235313334383132303735363336222c222d323830313630223a223131383530373733393638333431303539222c222d323830313730223a223330323032393633353235313330363738222c222d323830313830223a2231373233383832303532373837393332343330222c222d323830313930223a22313636373838333039333938373538303439222c222d323830323030223a223831303730333532383530313037353036222c222d323830323130223a223231383538393035303132323633383530222c222d323830323230223a223438303530343231353535343830303339222c222d323830323330223a223230333630333531373231373030393736222c222d323830323430223a223135393031383831353930393732303337222c222d323830323530223a223234353233323837373739323937353338222c222d323830323630223a223331343234383735343935343336353933222c222d323830323730223a22313030313630383437353333313737333937222c222d323830323830223a223334393134333238303339323630313733222c222d323830323930223a223432333335323130373131303236333138222c222d323830333030223a223138303438353130353830393934373739222c222d323830333130223a223734353331303739323436383034353837222c222d323830333230223a22313133343431333033383333393636333430222c222d323830333330223a22313436313638323033333732313130323131222c222d323830333430223a22323030393735373135313037383533393433222c222d323830333530223a223833303333313431383939303733363633222c222d323830333630223a22313032393933313935303036303839353031222c222d323830333730223a22313337333235393533383235373838353038222c222d323830333830223a22313033303830363437343633303837393637222c222d323830333930223a22313830343934333636363936313234333335222c222d323830343030223a223337353835313230353535383534343933222c222d323830343130223a22313130363432343531383734303633393237222c222d323830343230223a223939333632333434323331393736383535222c222d323830343330223a223134313135333530343237373232313530222c222d323830343430223a223939363736333630353935323737393032222c222d323830343530223a223932323837323437373832363735333038222c222d323830343630223a2237303438343636343433373232363530222c222d323830343730223a22313732333138353132353730343135353636222c222d323830343830223a223230343832343031303332373637313932222c222d323830343930223a223836303337313532303035303134323936222c222d323830353030223a2238333130343636383932323034383635222c222d323830353130223a223730323135303938303235353931313833222c222d323830353230223a223138343338313232363736353132373039222c222d323830353330223a223635373134303738383832343933323030222c222d323830353430223a223434313738313837333735383131363230222c222d323830353530223a223837393734373837343337333039393532222c222d323830353630223a223635333938303439333135363836343932222c222d323830353730223a223138313133353635333937373836313833222c222d323830353830223a223837323338373033303132353437383136222c222d323830353930223a2235303632393939343237393635353837222c222d323830363030223a223232383230303035333434313939313036222c222d323830363130223a223434313534323831343334383933313134222c222d323830363230223a223439393834323333323733313037353832222c222d323830363330223a22333730343034333130343431303234353837222c222d323830363430223a223235323933373830323638383437353330222c222d323830363530223a2232343837393431353534393836343739222c222d323830363630223a223232383033313230323239313137333737222c222d323830363730223a223239303239393732313030333036353138222c222d323830363830223a223238313438313534333431333639323634222c222d323830363930223a223237333731363333303333383136373839222c222d323830373030223a2237313236373739343730323639343839222c222d323830373130223a223138343838363030393139313630393235222c222d323830373230223a223132383531373035343836313532393032222c222d323830373330223a2238383238303738323430393132353834222c222d323830373430223a2237353233333736303539383335333032222c222d323830373530223a2234333433313738373238313735363232222c222d323830373630223a2235383732333039383938393938353838222c222d323830373730223a2235323439363031383933373639343936222c222d323830373830223a2234303333343138323239343830353130222c222d323830373930223a2232323434333137353939333433373633222c222d323830383030223a2239313837363731353132343231313138222c222d323830383130223a2234353437343230333432323332313339222c222d323830383230223a2234373835303831333538393039353331222c222d323830383330223a223231373437343035353936323038333035222c222d323830383430223a2234393237303133373432373531323638222c222d323830383530223a223233373035353938323935333633363331222c222d323830383630223a2238353637303635383033353830343231222c222d323830383730223a22333539383635333637343734343637343031222c222d323830383830223a2236323232303637343339353532373035222c222d323830383930223a2231343132363439323532303336393830222c222d323830393030223a223136333838303030313435363931343036222c222d323830393130223a2236393230323034373038373033343033222c222d323830393230223a223133373236323736303634343534303739222c222d323830393330223a2239363939353030363835393232383732222c222d323830393430223a2233303332353037333131313237393231222c222d323830393530223a2237303138323033353333303833303839222c222d323830393630223a2238333632343534323735303339343839222c222d323830393730223a223130353330353531393130313938323331222c222d323830393830223a2239323033313731333735353930343239222c222d323830393930223a2236383634303431383039363138303934222c222d323831303030223a2235343331383835333233333930343631222c222d323831303130223a22313036393831363636373530373935363835222c222d323831303230223a223430343936373233313937363330343839222c222d323831303330223a223139393333393136303036303334353537222c222d323831303430223a223231313235343137343334373138303439222c222d323831303530223a223932363135333636323236343430333430222c222d323831303630223a223135313339353734343330333333353738222c222d323831303730223a223234343132393932393737373030343033222c222d323831303830223a223135363834323736383231353331373833222c222d323831303930223a223231313037303538303030333134383438222c222d323831313030223a223238343136303138373436363533303533222c222d323831313130223a2238383837343831353036333833313738222c222d323831313230223a223336363232353236353535333331323435222c222d323831313330223a223432323136343735333133353130393632222c222d323831313430223a223231353138343230323838313835303731222c222d323831313530223a223232313139333530333435313332343331222c222d323831313630223a223130393234383236303936313236333334222c222d323831313730223a22323037303930383435393032343135393533222c222d323831313830223a2233373134363834393830343439393437222c222d323831313930223a223331383533323032303630313834363837222c222d323831323030223a223334353334393833323238363938343430222c222d323831323130223a223136323835363935323836383337313434222c222d323831323230223a223237393736303432373535333231303736222c222d323831323330223a223538383832343237373334383737353735222c222d323831323430223a223139313836323432393738323733333736222c222d323831323530223a223239303130343433353736323438333734222c222d323831323630223a223135343733343439333731323533353039222c222d323831323730223a22343038393337323134313938303836333931222c222d323831323830223a223332303238393030303333303439313932222c222d323831323930223a223931383737343532383637333536323230222c222d323831333030223a223233383636323835323834373435343933222c222d323831333130223a223132313136353039353839363134363932222c222d323831333230223a2236313235373736313338363937363535222c222d323831333330223a2238303630313830303938373033383839222c222d323831333430223a2231343835383837343036343030393032222c222d323831333530223a2234363032343536323231393736313536222c222d323831333630223a223236363530353237393932363838313633222c222d323831333730223a223138343833323736323136333439313036222c222d323831333830223a223236323335333731363634333533343338222c222d323831333930223a223438333937313132393236363832393538222c222d323831343030223a223132393236353435303434393038363334222c222d323831343130223a223738353038353733323234323334363735222c222d323831343230223a223133343536363634313931373234393130222c222d323831343330223a2231323235393633383333353636383437303834222c222d323831343430223a223132333438323735343732353738323337222c222d323831343530223a223132303436373133383138363134343534222c222d323831343630223a2238373333333335303238323235353733222c222d323831343730223a223335383436313834373835323934393135222c222d323831343830223a223138313832363539353033303532363933222c222d323831343930223a2237343839343233363936393639393834222c222d323831353030223a223130323232373435353239383636373639222c222d323831353130223a223232323232313639323037333138363133222c222d323831353230223a223336363936393639343734303638373730222c222d323831353330223a2237363335343638393932303333323035222c222d323831353430223a2236373935333131353435353939303038222c222d323831353530223a223430363238303930383935333138323930222c222d323831353630223a223232383131353835353733303437363633222c222d323831353730223a223135363732343733323536303236393532222c222d323831353830223a2238313337303938333130363638353034222c222d323831353930223a223131383733323939303830333933373839222c222d323831363030223a223131363133373538313232363033313136222c222d323831363130223a223132333335343431353731303736383832222c222d323831363230223a223131363434303834383037323135363630222c222d323831363330223a223138393031353037333931313935353633222c222d323831363430223a2239373538383834343136303631373831222c222d323831363530223a223132313338393233353039353039323231222c222d323831363630223a2232343936363733343339343036353433222c222d323831363730223a2235393031373531333732343033313834222c222d323831363830223a223130323638343838333634363534353630222c222d323831363930223a2232323530383939343233383331373332222c222d323831373030223a223131363335353532393630373030363238222c222d323831373130223a2233323231353731383930303830303931222c222d323831373230223a2236373839373834303438323638303038222c222d323831373330223a2233323536353035373135323636323334222c222d323831373430223a223130333732353335373934393537373232222c222d323831373530223a2233353537303232383331333032383732222c222d323831373630223a223334323037333930323034343636393535222c222d323831373730223a223132363636363931383334393032343637222c222d323831373830223a2234323239313330313737333635383533222c222d323831373930223a223130303838353035353936363739313432222c222d323831383030223a223138393235323231383630323834303736222c222d323831383130223a2239393537373932343134313633303639222c222d323831383230223a223136343331363739393337393736363139222c222d323831383330223a223133313133303031343939363832323037222c222d323831383430223a223136333430353333383635353138373532222c222d323831383530223a2238303035363332383830303636323931222c222d323831383630223a22313030333632333336343035353230383937222c222d323831383730223a2237323432343330363138333737373430222c222d323831383830223a223231353839343039373737383531363636222c222d323831383930223a223133353430313334333131343838333235222c222d323831393030223a2235393131313035343836313633313539222c222d323831393130223a22353232333731323530333732333433343631222c222d323831393230223a223230323439383134353731383332373136222c222d323831393330223a223133323135363237373036363135333331222c222d323831393430223a223139393730393332323539383132303736222c222d323831393530223a2239363232393637373036353338323932222c222d323831393630223a223135323739363834323530303735373139222c222d323831393730223a2238383137323637363631383432333632222c222d323831393830223a2239333932393339313332353734383237222c222d323831393930223a223136303536343333383437323938353430222c222d323832303030223a223239373535373936363232363039373436222c222d323832303130223a2236343032313831383937343931383334222c222d323832303230223a223436303539333637333139343633383731222c222d323832303330223a223836373734363535333538383934393433222c222d323832303430223a22313331393733333536363537373934393233222c222d323832303530223a223130333936343534313331373032353633222c222d323832303630223a223134303230343134323731393731363634222c222d323832303730223a223131373931373639363734323830343837222c222d323832303830223a223637353437373436373436363231343236222c222d323832303930223a223236353339363630333833333234393032222c222d323832313030223a223437333732303938383131313132383735222c222d323832313130223a223333333432353436343635363232333639222c222d323832313230223a22383031333034373332383437373331393738222c222d323832313330223a22383132393933343532343737333031323232222c222d323832313430223a223532353639303739393530333935303936222c222d323832313530223a223234363331323936363138333230383635222c222d323832313630223a223235323433373834353134313631353934222c222d323832313730223a22313832333539333635303430353337383533222c222d323832313830223a223436313032313635333039323835323235222c222d323832313930223a223537313239393333393332373834353335222c222d323832323030223a223233373532363430373131393037393538222c222d323832323130223a223531393337303532343535333936363836222c222d323832323230223a223431383433303834393332323538383935222c222d323832323330223a223534343430333236323738393236303932222c222d323832323430223a223334373832373435313236363433333633222c222d323832323530223a223537323432383835363535303032303237222c222d323832323630223a22313339323536393230393330393836313036222c222d323832323730223a223530353734383535333837363334333239222c222d323832323830223a223532343739343230393334353439353234222c222d323832323930223a223431313834323134303630333836313731222c222d323832333030223a22313838313936363739353731363935313130222c222d323832333130223a22323136333630303935363539303936323735222c222d323832333230223a22313231393134383631343038353432393130222c222d323832333330223a223533323736363631353936383936323531222c222d323832333430223a22313330353032363537313835383631303033222c222d323832333530223a223935303830383534373839323133373034222c222d323832333630223a223339353936393931313236343734343734222c222d323832333730223a223631343732333437303538373336323331222c222d323832333830223a223832333930303430393533343332383135222c222d323832333930223a22333234383733373732373338363632323439222c222d323832343030223a223330303330313330313034313939333638222c222d323832343130223a223135383737323639313532303330373237222c222d323832343230223a223330303036323136303932303635393435222c222d323832343330223a223736313837343637343930373537363638222c222d323832343430223a223231363034323735313431323031393934222c222d323832343530223a223833323736323837383434353730313130222c222d323832343630223a223338333531353238343834393231353232222c222d323832343730223a223330363531373033333731363038393836222c222d323832343830223a223437333531363137303638373835303337222c222d323832343930223a223732363538343535363530353537303830222c222d323832353030223a223235313435323636353130313738383434222c222d323832353130223a223134383433343739383936323838383039222c222d323832353230223a223138303938393130393334333234323036222c222d323832353330223a223130333037363434353733353432303034222c222d323832353430223a223136343132383334373733343139363434222c222d323832353530223a22323331313233373332303431373831373838222c222d323832353630223a22313730343338343830343938363738383939222c222d323832353730223a2236383037343135373531303532363034222c222d323832353830223a223439393335333730383937303637313034222c222d323832353930223a223131343737383937323833323639363334222c222d323832363030223a2232333438383136373532353832343733222c222d323832363130223a223135383039373237323138343134363931222c222d323832363230223a223737373135363731353434313930373030222c222d323832363330223a2235373538353839303138393536373334222c222d323832363430223a223133343132373933333134373633393031222c222d323832363530223a2233353538313531333133363338333133222c222d323832363630223a223434323532343133343738343737393932222c222d323832363730223a22313233353630363938303638383738363839222c222d323832363830223a22343830353537323136393135303933303634222c222d323832363930223a223237323730393835393330393836323634222c222d323832373030223a223137353831343038313336363833333637222c222d323832373130223a223335373439363438373330373631333335222c222d323832373230223a223231393434353430383431373932343535222c222d323832373330223a223532323239313830363834323031323037222c222d323832373430223a223235373136343832363331333639363235222c222d323832373530223a223836333030313333373138353839333137222c222d323832373630223a223132373534303032323633313731373030222c222d323832373730223a223233353637393236313336353037383831222c222d323832373830223a22333936393238363539353832333035393231222c222d323832373930223a223135353633363534383435393035323732222c222d323832383030223a223238363838303232363134323631333638222c222d323832383130223a223139343438373731343839323030343139222c222d323832383230223a223938353538303933353332383736393838222c222d323832383330223a223330383932393135383838333939313934222c222d323832383430223a223337353139333639333630323234393134222c222d323832383530223a223439383231313931363535323730333533222c222d323832383630223a22353531363239353332303637343332343133222c222d323832383730223a223339383734323030313537343732363135222c222d323832383830223a223832333639383832393032313732393036222c222d323832383930223a223138343337303836383636323534383635222c222d323832393030223a223538373032343535303039373637363035222c222d323832393130223a223332303538343431333833323938313939222c222d323832393230223a223437333138373134323135333330363733222c222d323832393330223a22313634363332303237383538313438353835222c222d323832393430223a223238363631363636383639373235313432222c222d323832393530223a223835353933303930333737393431323337222c222d323832393630223a223436363930363533383531313234303736222c222d323832393730223a223331353532353536333934393835323734222c222d323832393830223a223130393534333035353839393036323632222c222d323832393930223a223431393637383931313838373332333035222c222d323833303030223a223130303634373838383433393334383330222c222d323833303130223a2238393433353137333938333437323539222c222d323833303230223a223630343639343830393530323431363933222c222d323833303330223a22313338313237333637343438363333363832222c222d323833303430223a223334363738313231313434383134393437222c222d323833303530223a22313534313339343738393739353232363532222c222d323833303630223a223437343334343739383434373630393432222c222d323833303730223a22313431303630313238373930383335303331222c222d323833303830223a2239373137343635323633313232323638222c222d323833303930223a223436313238333734343235333931393134222c222d323833313030223a223631303136383239393432353030343933222c222d323833313130223a223531323037343234373331373930393032222c222d323833313230223a223630393936323433303630393231313539222c222d323833313330223a223933303132303134333230383933303036222c222d323833313430223a223936333430353335313130353038313537222c222d323833313530223a2239363431353738393637313933333639222c222d323833313630223a223131353935303331363334373732393233222c222d323833313730223a223238383130303739363736393139393734222c222d323833313830223a223935303430393136343639353639373836222c222d323833313930223a2231373833303937353136363036383534222c222d323833323030223a2237303736333536323138323734393336222c222d323833323130223a223131343938353132373831333932353939222c222d323833323230223a223330303736363939373435333932303338222c222d323833323330223a223238333038313031303835363636222c222d323833323430223a2234373734393239373633343831333834222c222d323833323530223a22313435353132373239333235363234313639222c222d323833323630223a2231333536353630383831333035333734333631222c222d323833323730223a2234303733353039323135343834373335222c222d323833323830223a22373234313738313437373630333236222c222d323833323930223a22333833393736333739343235313937333431222c222d323833333030223a2233303436303739353933323235393038222c222d323833333130223a22353035343033383038373035303533353830222c222d323833333230223a2232323039343238353832393839333130222c222d323833333330223a22373535353130343836333939303932383530222c222d323833333430223a223336383137313235383132373234383735222c222d323833333530223a2235333538383738363031373231353733222c222d323833333630223a223231363733343835363135373330353132222c222d323833333730223a22353636343836323833353236313332222c222d323833333830223a22313830363836333736343539333136222c222d323833333930223a2231343734333332313134363038343833222c222d323833343030223a22313234393436313730363738353436222c222d323833343130223a2232343339333830333130373335313638222c222d323833343230223a22383731363335303330323037303434222c222d323833343330223a2233313430373839383330343231313935222c222d323833343430223a2231343034323132353039373237383539222c222d323833343530223a223337393737313532363934383534323233222c222d323833343630223a223234323339313637393734373239303537222c222d323833343730223a2230222c222d323833343830223a223238393134373639343430333239353936222c222d323833343930223a22353939313838383138393135333433222c222d323833353030223a22323337393839383137303239222c222d323833353130223a223139323833383339363034323339373837222c222d323833353230223a223334323339383032393631353530222c222d323833353330223a2235333730343036363230363638393732222c222d323833353430223a22353837353236303037343236323038222c222d323833353530223a2231373931323737353132303837313933222c222d323833353630223a223730303532313837343539303635222c222d323833353730223a2233313438313739333732333736363939222c222d323833353830223a223530343036363936323636303533373137222c222d323833353930223a2235323535343635373939363932313533222c222d323833363030223a2238393736303330323733393730343434222c222d323833363130223a223334393131323536373735383332313732222c222d323833363230223a2237333533313839363439303531343632222c222d323833363330223a2231303438353131363333333130333636222c222d323833363430223a22363138373338343733333035393031323537222c222d323833363530223a22313338363333393439343433343736222c222d323833363630223a22313833353136383131303035363737323834222c222d323833363730223a22353237343434393534333230343238222c222d323833363830223a22333830363537373035363134393039222c222d323833363930223a22343430303437333631313634323737303134222c222d323833373030223a2232393230343634383035353436373338222c222d323833373130223a223334313631363331393739333035373730222c222d323833373230223a22333434303935303138393837323831222c222d323833373330223a2231353533363531323033353437393932222c222d323833373430223a2234343035353631373239373133383934222c222d323833373530223a22353633303639303030343334393331222c222d323833373630223a2231323538343434343331373232353634222c222d323833373730223a22313533393739373136363834333338222c222d323833373830223a22313834363131343537323932303432222c222d323833373930223a22323735393232363630343339363534222c222d323833383030223a22333533333136373839383133363238222c222d323833383130223a2239303835303634363739323732343232222c222d323833383230223a2232393739303531333731323731353638222c222d323833383330223a2232373738343738333335353539393736222c222d323833383430223a2233343837343932303938383230303935222c222d323833383530223a2234373538353036323532393130363637222c222d323833383630223a2231343436383530393930313633393632222c222d323833383730223a2231303434303935303933363733343639222c222d323833383830223a22373339323330363235323539393237222c222d323833383930223a2231313033353037323938343733353432222c222d323833393030223a22343239313137303032393834383633222c222d323833393130223a2234393033313731383230323933343139222c222d323833393230223a2231313336313535323130343337353838222c222d323833393330223a2234363831323032363034373839383738222c222d323833393430223a22373537303339363831363633343836222c222d323833393530223a22323833353038363431363836373631222c222d323833393630223a22333738313730393635303730383336222c222d323833393730223a22353030343332313637393832323133222c222d323833393830223a223739353634393630333931323135313834222c222d323833393930223a2232383433373638303531383433303233222c222d323834303030223a2235303739393334353837343530313337222c222d323834303130223a2237343439373738353737383838313237222c222d323834303230223a2232313138383834373734363731383135222c222d323834303330223a22393334313032343136383432222c222d323834303430223a22343835323837343630393039393933222c222d323834303530223a22313938373637383337353138313431222c222d323834303630223a22363236393632393539303634303236222c222d323834303730223a223239343835303638343539373530343039222c222d323834303830223a22343139353730383437303333343331353330222c222d323834303930223a223132363330363938313732343233383931222c222d323834313030223a2239313231393134393833383038323136222c222d323834313130223a223137353932323839333534303034393535222c222d323834313230223a223632393034393139303836303130323839222c222d323834313330223a223133393833333634353631373834333036222c222d323834313430223a223134393233303934373430393234373339222c222d323834313530223a2233373330323031363438313731393933222c222d323834313630223a223135313738343935353733353637353336222c222d323834313730223a2231333533373532303736333338333337222c222d323834313830223a2233373838313238353932313432393139222c222d323834313930223a22323438353333393032303130323839222c222d323834323030223a2236313931353035303834383735323335222c222d323834323130223a22373333313334363733353232363835222c222d323834323230223a2233323635383934313238363436313739222c222d323834323330223a22353838353332333930373737333634222c222d323834323430223a223132343631313330393931393734343734222c222d323834323530223a2238393032383535383339353130353830222c222d323834323630223a223631373534323734323330313138313331222c222d323834323730223a2237303236363634393230383635303333222c222d323834323830223a2231363439393432383133323330313235222c222d323834323930223a22323936363335373734353338222c222d323834333030223a223337343836393230363837353430313637222c222d323834333130223a22363636343536383536343731353337353738222c222d323834333230223a223234393537303736323735393331222c222d323834333330223a2235393739383337343432363339222c222d323834333430223a223136323531363339323235353139222c222d323834333530223a2231383134383236333032313835222c222d323834333630223a2231383134383236333032313835222c222d323834333730223a2230222c222d323834333830223a2230222c222d323834333930223a223230353833343137333733222c222d323834343030223a2233313736383730363232363536222c222d323834343130223a2230222c222d323834343230223a2230222c222d323834343330223a223132303731343239343135333634333233222c222d323834343430223a2230222c222d323834343530223a2230222c222d323834343630223a22323736393636383637313635222c222d323834343730223a223535343631313338383437363131222c222d323834343830223a2231323435373830323339303034353136222c222d323834343930223a2230222c222d323834353030223a2230222c222d323834353130223a223631303332323631353936393536222c222d323834353230223a22373734353237333436363838222c222d323834353330223a2235373238373833343230353036363931222c222d323834353430223a223132393330313337313839323432222c222d323834353530223a2230222c222d323834353630223a22353537383338303736363738363739222c222d323834353730223a22333033393739323339313538222c222d323834353830223a22383235343632393836323030323631222c222d323834353930223a2234333030393831373037333838222c222d323834363030223a2230222c222d323834363130223a2230222c222d323834363230223a2230222c222d323834363330223a2230222c222d323834363430223a22323237383134373536383731222c222d323834363530223a2237383431363632333336373434222c222d323834363630223a2234313934303039333531373737222c222d323834363730223a22313937343839363636323138343139383631222c222d323834363830223a2230222c222d323834363930223a22333333343238313532323031303830222c222d323834373030223a22323735313832353537323335303939222c222d323834373130223a2230222c222d323834373230223a2230222c222d323834373330223a2230222c222d323834373430223a2230222c222d323834373530223a2230222c222d323834373630223a22313830323836303835303430323736222c222d323834373730223a2230222c222d323834373830223a2230222c222d323834373930223a2230222c222d323834383030223a22363335373131343033313930363730222c222d323834383130223a2230222c222d323834383230223a22313230393237393132353638222c222d323834383330223a2230222c222d323834383430223a2230222c222d323834383530223a2230222c222d323834383630223a2237383233393234353938313439363739222c222d323834383730223a2230222c222d323834383830223a223336373831303536353934363630222c222d323834383930223a2230222c222d323834393030223a2230222c222d323834393130223a2230222c222d323834393230223a2230222c222d323834393330223a2230222c222d323834393430223a223339363832373234363635373230222c222d323834393530223a2232333838393634353239343133303335222c222d323834393630223a2230222c222d323834393730223a2230222c222d323834393830223a223338353430363736353438303034222c222d323834393930223a2231383032323134393739343332333337222c222d323835303030223a223937303639373435323534343633313836222c222d323835303130223a2230222c222d323835303230223a2230222c222d323835303330223a223335383531393234363936303631222c222d323835303430223a2230222c222d323835303530223a2230222c222d323835303630223a22373337373235353834323136222c222d323835303730223a2231313037393538333931353332303938222c222d323835303830223a2230222c222d323835303930223a2231333933353631323238393735353136222c222d323835313030223a2230222c222d323835313130223a22373230323033313533363938373831222c222d323835313230223a22373335353330363239303039222c222d323835313330223a2230222c222d323835313430223a2230222c222d323835313530223a223238313139313433313935373231222c222d323835313630223a2230222c222d323835313730223a223235373137303134363332373038222c222d323835313830223a2231323835303137353531383731323730222c222d323835313930223a2230222c222d323835323030223a2231323833393233343937363834383530222c222d323835323130223a2232303633333039323235363434333030222c222d323835323230223a223734333839383037373836383633222c222d323835323330223a2232303737363038333331333538343139222c222d323835323430223a22333233323438323336313533393937222c222d323835323530223a22313832313536323930353839343838222c222d323835323630223a223233303933373739303534303037222c222d323835323730223a2230222c222d323835323830223a2230222c222d323835323930223a22373139353037363638323032333432222c222d323835333030223a22333034333533353130353437222c222d323835333130223a22373139363735373838313037343435222c222d323835333230223a2231353638383233373238313837353932222c222d323835333330223a2230222c222d323835333430223a2231353638383639373332383330313133222c222d323835333530223a2230222c222d323835333630223a223339323337373334353230343730363334222c222d323835333730223a2230222c222d323835333830223a22313334393034353630343931222c222d323835333930223a22393837323338333634373035393635222c222d323835343030223a223633353537343434303438222c222d323835343130223a2230222c222d323835343230223a2230222c222d323835343330223a2239353138363936323433303235222c222d323835343430223a2230222c222d323835343530223a223633303232363837313438222c222d323835343630223a22323331323630373538323434363038222c222d323835343730223a223331363034373731373731363339393437222c222d323835343830223a223435373233353539373431323438303235222c222d323835343930223a223332393730313430353432303636383138222c222d323835353030223a223439363430373735323837333437393035222c222d323835353130223a2230222c222d323835353230223a2237363138343935373531383232222c222d323835353330223a22313534373132373534323135303430222c222d323835353430223a2230222c222d323835353530223a22323231313136303131383739343430222c222d323835353630223a223939303537393730373532343635222c222d323835353730223a2231323138313233353937313934303136222c222d323835353830223a223633393232333131373232313630383130222c222d323835353930223a2230222c222d323835363030223a22323231313136303131383739343430222c222d323835363130223a2230222c222d323835363230223a2230222c222d323835363330223a2230222c222d323835363430223a2230222c222d323835363530223a2230222c222d323835363630223a2230222c222d323835363730223a2230222c222d323835363830223a2231323438383832343833323139222c222d323835363930223a2230222c222d323835373030223a2231323438383832343833323139222c222d323835373130223a223739393835373232363037303333222c222d323835373230223a2230222c222d323835373330223a2232363730363831383032393132363936222c222d323835373430223a223134373035313938343638383831323639222c222d323835373530223a2232353930363936303830333035363633222c222d323835373630223a22323137343438393339363730393934222c222d323835373730223a22323936313835333334333036303832222c222d323835373830223a2230222c222d323835373930223a22313630343532303536303735343137222c222d323835383030223a2230222c222d323835383130223a2233383731353231373330373837313530222c222d323835383230223a2231363038353336363739343130222c222d323835383330223a2233383731353231373330373837313530222c222d323835383430223a2232383233353736353836333335373731222c222d323835383530223a2230222c222d323835383630223a2234303232353131363735323137343331222c222d323835383730223a2232313930313033373936323633373936222c222d323835383830223a2230222c222d323835383930223a2232313930313033373936323633373936222c222d323835393030223a2230222c222d323835393130223a2234323937343832313336363437222c222d323835393230223a2230222c222d323835393330223a2230222c222d323835393430223a22363138303236303537333337383634222c222d323835393530223a2230222c222d323835393630223a22363138303236303537333337383634222c222d323835393730223a2230222c222d323835393830223a2230222c222d323835393930223a22333434333834303036393733363434222c222d323836303030223a2236393138353636363330373837373635222c222d323836303130223a22333434333834303036393733363434222c222d323836303230223a22383038333538333338393936222c222d323836303330223a2230222c222d323836303430223a2232393431373333343233383836222c222d323836303530223a2230222c222d323836303630223a2232393431373333343233383836222c222d323836303730223a223832393031383933373335343432333035222c222d323836303830223a2230222c222d323836303930223a2230222c222d323836313030223a2230222c222d323836313130223a2230222c222d323836313230223a2230222c222d323836313330223a22363132313832393030383832222c222d323836313430223a22323731333633383039323839222c222d323836313530223a22313232393536393738343739343238222c222d323836313630223a22313232363136313539333837383335222c222d323836313730223a2230222c222d323836313830223a2230222c222d323836313930223a2230222c222d323836323030223a2235333933383035393138303237222c222d323836323130223a223436343536373330333834343930222c222d323836323230223a2234343431373839222c222d323836323330223a223438303938353830363938333232222c222d323836323430223a2230222c222d323836323530223a2231363431383530333133383332222c222d323836323630223a2230222c222d323836323730223a22353434303936343139333330222c222d323836323830223a22313231393038383135323531353830222c222d323836323930223a22313238323332343632303233333933222c222d323836333030223a22363037303031363536373634313135222c222d323836333130223a2236333233363436373731383133222c222d323836333230223a22363037303031363536373634313135222c222d323836333330223a22323433343338313031343832373236222c222d323836333430223a2230222c222d323836333530223a223136353137333035333237333030222c222d323836333630223a2230222c222d323836333730223a223136353234303734343036373930222c222d323836333830223a2230222c222d323836333930223a2230222c222d323836343030223a2230222c222d323836343130223a2230222c222d323836343230223a2230222c222d323836343330223a2230222c222d323836343430223a2230222c222d323836343530223a2230222c222d323836343630223a2230222c222d323836343730223a2230222c222d323836343830223a2230222c222d323836343930223a2231383936383030383139363932343139222c222d323836353030223a2230222c222d323836353130223a2230222c222d323836353230223a2230222c222d323836353330223a2230222c222d323836353430223a2233363231323931303038393935303539222c222d323836353530223a2230222c222d323836353630223a2230222c222d323836353730223a2230222c222d323836353830223a2230222c222d323836353930223a2230222c222d323836363030223a2230222c222d323836363130223a2230222c222d323836363230223a2230222c222d323836363330223a2230222c222d323836363430223a2230222c222d323836363530223a2230222c222d323836363630223a22323135353537313938323436222c222d323836363730223a2230222c222d323836363830223a2230222c222d323836363930223a2230222c222d323836373030223a22343837363638383636303932222c222d323836373130223a2230222c222d323836373230223a2230222c222d323836373330223a22353439363936323834222c222d323836373430223a2230222c222d323836373530223a2232303532333039323036303231222c222d323836373630223a2230222c222d323836373730223a2230222c222d323836373830223a2230222c222d323836373930223a22363835393432303739353932222c222d323836383030223a2230222c222d323836383130223a2230222c222d323836383230223a22323837303433393838373339353136313530222c222d323836383330223a2230222c222d323836383430223a2230222c222d323836383530223a2230222c222d323836383630223a2230222c222d323836383730223a2230222c222d323836383830223a2230222c222d323836383930223a2230222c222d323836393030223a2230222c222d323836393130223a2230222c222d323836393230223a2230222c222d323836393330223a2230222c222d323836393430223a2230222c222d323836393530223a2230222c222d323836393630223a2230222c222d323836393730223a22393535393033323539353337393431222c222d323836393830223a2230222c222d323836393930223a2230222c222d323837303030223a2230222c222d323837303130223a2230222c222d323837303230223a2230222c222d323837303330223a2230222c222d323837303430223a2230222c222d323837303530223a2230222c222d323837303630223a2230222c222d323837303730223a2230222c222d323837303830223a2230222c222d323837303930223a2232303730333036303037343734393033222c222d323837313030223a2230222c222d323837313130223a2230222c222d323837313230223a2230222c222d323837313330223a2230222c222d323837313430223a2230222c222d323837313530223a2230222c222d323837313630223a2230222c222d323837313730223a2230222c222d323837313830223a2230222c222d323837313930223a2230222c222d323837323030223a2230222c222d323837323130223a2230222c222d323837323230223a2230222c222d323837323330223a2230222c222d323837323430223a2230222c222d323837323530223a2232303532363039353439343930222c222d323837323630223a2230222c222d323837323730223a2230222c222d323837323830223a2230222c222d323837323930223a22343830343837323335363532393139222c222d323837333030223a2230222c222d323837333130223a223337323632393034353232353734222c222d323837333230223a2235363232363033313530333338353034222c222d323837333330223a2230222c222d323837333430223a2230222c222d323837333530223a2230222c222d323837333630223a2230222c222d323837333730223a2230222c222d323837333830223a2230222c222d323837333930223a2230222c222d323837343030223a2230222c222d323837343130223a2231323632363933323834303436353134222c222d323837343230223a2230222c222d323837343330223a2230222c222d323837343430223a2230222c222d323837343530223a22373538383935383935373338222c222d323837343630223a2230222c222d323837343730223a2230222c222d323837343830223a2230222c222d323837343930223a2230222c222d323837353030223a2230222c222d323837353130223a2230222c222d323837353230223a2230222c222d323837353330223a2230222c222d323837353430223a2230222c222d323837353530223a2230222c222d323837353630223a2230222c222d323837353730223a2230222c222d323837353830223a2230222c222d323837353930223a2230222c222d323837363030223a2230222c222d323837363130223a2230222c222d323837363230223a2230222c222d323837363330223a2232383730383137353332313833323435222c222d323837363430223a2230222c222d323837363530223a2230222c222d323837363630223a22333534373733313739353338343031222c222d323837363730223a2230222c222d323837363830223a2230222c222d323837363930223a2230222c222d323837373030223a2230222c222d323837373130223a2230222c222d323837373230223a22323837303336313530383434303039222c222d323837373330223a2230222c222d323837373430223a2230222c222d323837373530223a2230222c222d323837373630223a2230222c222d323837373730223a2230222c222d323837373830223a2230222c222d323837373930223a2230222c222d323837383030223a2232353239353637333331353437363134222c222d323837383130223a2230222c222d323837383230223a2230222c222d323837383330223a2230222c222d323837383430223a223134363133303131323933222c222d323837383530223a2230222c222d323837383630223a2230227d7d"
	serializedData, err := hex.DecodeString(serializedPoolStr)
	if err != nil {
		t.Fatalf("Failed to decode serialized pool: %v", err)
	}
	p := &UniswapV3Pool{}
	err = p.testDeserializeFull(serializedData)
	if err != nil {
		t.Fatalf("Failed to deserialize pool: %v", err)
	}

	input := big.NewInt(0).Mul(big.NewInt(1e18), big.NewInt(1e4))
	out, err := p.Output(p.tokenA, p.tokenB, input)
	if err != nil {
		t.Fatalf("Failed to get output: %v", err)
	}
	outExpected := big.NewInt(5195558554)
	if out.Cmp(outExpected) != 0 {
		t.Fatalf("Output amount is not correct, expected: %s, got: %s", outExpected.String(), out.String())
	}

	input = big.NewInt(1e6 * 1e6)
	out, err = p.Output(p.tokenB, p.tokenA, input)
	if err != nil {
		t.Fatalf("Failed to get output: %v", err)
	}

	outExpected, _ = new(big.Int).SetString("1734561578172737641313936", 10)
	if out.Cmp(outExpected) != 0 {
		t.Fatalf("Output amount is not correct, expected: %s, got: %s", outExpected.String(), out.String())
	}
}
